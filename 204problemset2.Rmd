---
title: "204problemset2"
author: "Claire Madden"
date: "4/25/2019"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#set up 
library(tidyverse)
library(reconPlots)

#read in data
gasdata <- read_csv("Gas_Data.csv")

#change column headers to be more simple
names(gasdata) <- c("price", "q_low", "q_high")


```


1. What is the aggregate daily demand curve for gasoline in France? What is the supply curve for gasoline? What is the “benefit” to consumers under the status quo? What is the “benefit” to producers under the status quo? What is the environmental cost under the status quo?

```{r}
#need to find: high demand curve, low demand curve, aggregate demand curve, supply curve (mpc), environmental cost curve (mec) 

#high linear model demand curve:

d_high <- lm(price ~ q_high, data = gasdata)
summary(d_high)
#p=a(q)+b
#p= -0.0001297(q) + 23.39

#saving output numbers for use later
a_high <- d_high$coefficients[2]
b_high <- d_high$coefficients[1]

#high demand curve function p=a*q+b
demand_high <- function(x){a_high*x + b_high}

#variables for high demand curve q=p/a - b/a
a_high1 <- (1/a_high)
b_high1 <- (-b_high/a_high)


#low demand curve:

d_low <- lm(price ~ q_low, data = gasdata)
summary(d_low)
#p=a(q)+b
#p= -0.0001355(q) + 21.99

#saving output numbers for use later
a_low <- d_low$coefficients[2]
b_low <- d_low$coefficients[1]

#low demand curve function p=a*q+b
demand_low <- function(x){a_low*x + b_low}

#variables for low demand curve q=p/a - b/a
a_low1 <- (1/a_low)
b_low1 <- (-b_low/a_low)




#combine high and low variables to get aggregate 
a_agg <- a_high1 + a_low1
b_agg <- b_high1 + b_low1

#rearrage to get p=
a_agg1 <- (1/a_agg)
b_agg1 <- (-b_agg/a_agg)

agg_demand <- function(x){a_agg1*x + b_agg1}

#need to know what q equals when p is 21.99085 for aggregate demand curve


#supply curve (mpc)
supply <- 5/((5-b_agg1)/(a_agg1))

#supply function
supply_curve <- function(x){supply*x}

#environmental cost
mec <- function(x){0*x + 2}

#social cost
msc <- function(x){supply*x + 2}


#graph both demand functions on the same axes
allcurves <- ggplot(data.frame(x = c(7000, 500000)), aes(x = x)) +
  stat_function(fun = demand_low, color = "cadetblue4") +
  stat_function(fun = demand_high, color = "orchid4")+
  stat_function(fun = agg_demand, color = "tomato3")+
  stat_function(fun = mec, color = "turquoise")+
  stat_function(fun = msc, color = "gold")+
  stat_function(fun = supply_curve, color = "olivedrab4")+
  scale_y_continuous(limits = c(0,30), expand = c(0,0))+
  scale_x_continuous(limits = c(0,400000), expand = c(0,0))


allcurves

```

```{r}

x_range <- 0:500000

#intersection of aggregate demand and high demand curves
kink <- curve_intersect(agg_demand, demand_high, empirical = FALSE, domain = c(min(x_range), max(x_range))) 

kink

kink_q <- kink$x

kink_p <- kink$y

#intersection of supply and high demand
int_supp_highd <- curve_intersect(supply_curve, demand_high, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_supp_highd

int_supp_highd_q <- int_supp_highd$x

int_supp_highd_p <- int_supp_highd$y

#intersection of supply and low demand

int_supp_lowd <- curve_intersect(supply_curve, demand_low, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_supp_lowd

int_supp_lowd_q <- int_supp_lowd$x

int_supp_lowd_p <- int_supp_lowd$y


#intersection of supply and agg demand

int_supp_aggd <- curve_intersect(supply_curve, agg_demand, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_supp_aggd

int_supp_highd_q <- int_supp_aggd$x

int_supp_highd_p <- int_supp_aggd$y


#intersection of msc and agg demand

int_msc_aggd <- curve_intersect(msc, agg_demand, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_msc_aggd
                                
int_msc_aggd_q <- int_msc_aggd$x

int_msc_aggd_p <- int_msc_aggd$y




```


```{r}
#low demand benefit under status quo

base_cs_low <- b_low - int_supp_lowd_p
height_cs_low <- int_supp_lowd_q

cs_low <- (1/2)*base_cs_low*height_cs_low

cs_low


base_ps_low <- int_supp_lowd_p
height_ps_low <- int_supp_lowd_q

ps_low <- (1/2)*base_ps_low*height_ps_low

ps_low


#high demand benefit under status quo

base_cs_high <- b_high - int_supp_highd_p
height_cs_high <- int_supp_highd_q

cs_high <- (1/2)*base_cs_high*height_cs_high

cs_high


base_ps_high <- int_supp_highd_p
height_ps_high <- int_supp_highd_q

ps_high <- (1/2)*base_ps_high*height_ps_high

ps_high

#aggregate benefit under status quo

cs_agg <- cs_high + cs_low

cs_agg

ps_agg <- ps_high + ps_low

ps_agg


```

```{r}
#environmental cost under status quo

base_tec <- int_supp_highd_q
height_tec <- 2

tec <- base_tec*height_tec

tec

```

2. How is the current consumer benefit divided between “High” and “Low” income consumers?
```{r}

prop_low <- cs_low/cs_agg
prop_low

prop_high <- cs_high/cs_agg
prop_high

```

3. A gas tax of $0.50/gal. is proposed. What would be the effects of this tax on:
a. The amount of gasoline produced and sold in France.
b. The price of gasoline.
c. Welfare of “High” income consumers.
d. Welfare of “Low” income consumers.
e. Welfare of gas producers.
f. Total environmental damage.
g. Total revenue generated by the tax.


```{r}

supply_tax <- function(x){supply*x + 0.5}

#a. amount of gasoline produced and sold in france
q_tax <- curve_intersect(supply_tax, agg_demand, empirical = FALSE, domain = c(min(x_range), max(x_range)))

q_tax

tax0.5_q <- q_tax$x 

#b. price of gasoline with tax
tax0.5_p <- q_tax$y

#c. high cs

int_tax_high <- curve_intersect(supply_tax, demand_high, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_tax_high

int_tax_high_q <- int_tax_high$x
int_tax_high_p <- int_tax_high$y

base_high_tax0.5 <- int_tax_high_q
height_high_tax0.5 <- b_high - int_tax_high_p

cs_tax_high <- (1/2)*base_high_tax0.5*height_high_tax0.5
cs_tax_high

#d. low cs

int_tax_low <- curve_intersect(supply_tax, demand_low, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_tax_low

int_tax_low_q <- int_tax_low$x
int_tax_low_p <- int_tax_low$y


base_low_tax0.5 <- int_tax_low_q
height_low_tax0.5 <- b_low - int_tax_low_p

cs_tax_low <- (1/2)*base_low_tax0.5*height_low_tax0.5
cs_tax_low

#e. producer surplus

base_ps_tax0.5 <- tax0.5_q
height_ps_tax0.5 <- tax0.5_p - 0.5

ps_tax0.5 <- (1/2)*base_ps_tax0.5*height_ps_tax0.5
ps_tax0.5

#f. total environmental damage

tec_tax0.5 <- tax0.5_q*2
tec_tax0.5

#g. tax revenue

tax_rev_tax <- tax0.5_q*0.5
tax_rev_tax


```

4. Now, assume that all revenue from a tax will be used for infrastructure repairs, and that the benefit of this is proportional to the amount you drive (i.e. to the gas you consume). Also assume that “Low” income consumers bear all environmental costs. For a range of gas taxes (ranging from $0 - $5.00/gal), calculate the effects of the tax on:
a. Overall welfare of “High” income consumers
b. Overall welfare of “Low” income consumers
c. Gas producers




5. Finally, assume that electric cars will gain popularity and that in the future this
will lower the demand curves of all income groups by half (vertically). Under these new demand curves, what are the effects on:
a. Gas consumption by “High” income consumers
b. Gas consumption by “Low” income consumers
c. Gas price
d. Environmental damage from gasoline

```{r}

#lower demand curves by half vertically

half_demand_high <- function(x){a_high*x + 0.5*b_high}

half_demand_low <- function(x){a_low*x + 0.5*b_low}

half_agg_demand <- function(x){a_agg1*x + 0.5*b_agg1}

#intersect new high demand and supply with tax

int_tax_half_high_demand <- curve_intersect(supply_tax, half_demand_high, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_tax_half_high_demand

#a. gas consumption by high demand
int_tax_half_high_demand_q <- int_tax_half_high_demand$x


#intersect new low demand and supply with tax
int_tax_half_low_demand <- curve_intersect(supply_tax, half_demand_low, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_tax_half_low_demand

#b. gas consumption by low demand
int_tax_half_low_demand_q <- int_tax_half_low_demand$x

#intersect agg demand and supply with tax
int_tax_half_agg_demand <- curve_intersect(supply_tax, half_agg_demand, empirical = FALSE, domain = c(min(x_range), max(x_range)))

int_tax_half_agg_demand

#c. gas price at new equilibrium - where aggregate demand (reduced by half) intersects supply with tax
int_tax_half_agg_demand_p <- int_tax_half_agg_demand$y


#d. environmental damage from gasoline

#quantity at new equilirium
int_tax_half_agg_demand_q <- int_tax_half_agg_demand$x

# environmental cost at new equilibrium

tec_half_demand <- int_tax_half_agg_demand_q*2

tec_half_demand

```



6. Using these numbers, which has a bigger impact on environmental quality, a $2.00/gal. gas tax or the invention of electric cars? Provide your evidence.





